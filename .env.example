# SnapAuth Platform Environment Configuration
# Copy this file to .env and run: make up

# =============================================================================
# FusionAuth Configuration
# =============================================================================

FUSIONAUTH_BASE_URL=http://fusionauth:9011
FUSIONAUTH_TENANT_ID=d7d09513-a3f5-401c-9685-34ab6c552453
FUSIONAUTH_APPLICATION_NAME=SnapAuth

# These will be generated by bootstrap script - DO NOT set manually
#FUSIONAUTH_API_KEY_ID=
#FUSIONAUTH_API_KEY=
#FUSIONAUTH_APPLICATION_ID=
#FUSIONAUTH_CLIENT_SECRET=
#FUSIONAUTH_ADMIN_PASSWORD=
#FUSIONAUTH_ADMIN_USER_ID=

FUSIONAUTH_ADMIN_USERNAME=admin
FUSIONAUTH_ADMIN_APPLICATION_ID=3c219e58-ed0e-4b18-ad48-f4f92793ae32
FUSIONAUTH_AUTHORIZED_REDIRECT_URLS=http://localhost:3000/oauth-callback

# FusionAuth Runtime Configuration
FUSIONAUTH_APP_MEMORY=512M
FUSIONAUTH_APP_RUNTIME_MODE=production

# =============================================================================
# SnapAuth Service Configuration  
# =============================================================================

SNAPAUTH_SERVICE_PORT=8080

# JWT Configuration
JWT_EXPECTED_AUD=
JWKS_CACHE_TTL_SECONDS=300

# =============================================================================
# SnapAuth Security Configuration (v2.0.0+)
# =============================================================================

# Admin API Key - REQUIRED for administrative operations
# Generated by bootstrap script using secrets.token_urlsafe(32)
# Provide this key via X-SnapAuth-API-Key header for admin endpoints
#SNAPAUTH_ADMIN_API_KEY=

# Admin API Keys (for zero-downtime rotation)
# Comma-separated list of valid API keys
# Example: key1,key2,key3
# During rotation, both old and new keys are valid simultaneously
#SNAPAUTH_ADMIN_API_KEYS=

# IP Whitelisting (CIDR notation)
# Comma-separated list of allowed IP addresses or ranges
# Default: RFC 1918 private networks
# Examples:
#   Single IP: 192.168.1.100
#   CIDR range: 10.0.0.0/8,172.16.0.0/12,192.168.0.0/16
#   Multiple: 192.168.1.0/24,203.0.113.50,2001:db8::/32
ADMIN_ALLOWED_IPS=10.0.0.0/8,172.16.0.0/12,192.168.0.0/16

# Trust X-Forwarded-For header (when behind reverse proxy/load balancer)
# Set to 'true' when SnapAuth is behind Nginx, ALB, or other proxy
TRUST_PROXY=true

# Rate Limiting
RATE_LIMIT_ENABLED=true
RATE_LIMIT_PER_MINUTE=60           # Authenticated endpoints
RATE_LIMIT_PER_MINUTE_AUTH=10      # Login/refresh endpoints (strict)
RATE_LIMIT_PER_MINUTE_ADMIN=30     # Admin endpoints

# =============================================================================
# Database Configuration
# =============================================================================

DB_HOST=db
DB_PORT=5432
DB_NAME=fusionauth
DB_USER=fusionauth
# Generated by bootstrap script - DO NOT set manually
#DB_PASSWORD=

# =============================================================================
# Backup Configuration (Optional)
# =============================================================================

# Encryption key for backup files (AES-256-CBC)
# Generate with: openssl rand -base64 32
# Store this key securely - required for restore
#BACKUP_ENCRYPTION_KEY=

# Backup directory (default: /opt/snapauth-backups)
#BACKUP_DIR=/opt/snapauth-backups

# =============================================================================
# Deployment Mode (Optional)
# =============================================================================

# Shared services network name (for microservices mode)
# Used when deploying with: make up MODE=microservices
#SHARED_SERVICES_NETWORK=shared-services

# =============================================================================
# Security Warnings and Best Practices
# =============================================================================

# ⚠️  IMPORTANT SECURITY NOTES:
#
# 1. API Key Security:
#    - NEVER commit API keys to version control
#    - Rotate keys regularly (use scripts/manage-secrets.sh rotate)
#    - Use strong, randomly generated keys (32+ bytes)
#    - Store keys in secrets manager for production
#
# 2. IP Whitelisting:
#    - Restrict ADMIN_ALLOWED_IPS to known networks
#    - Use CIDR notation for network ranges
#    - Consider using VPN for admin access
#    - Monitor failed authentication attempts
#
# 3. TLS/HTTPS:
#    - ALWAYS use TLS in production (Nginx handles this)
#    - For production, replace self-signed certs with Let's Encrypt:
#      See docs/SECURITY.md for certbot integration
#
# 4. Database Security:
#    - DB_PASSWORD is auto-generated with high entropy
#    - Database is NOT exposed externally (internal network only)
#    - Backup database regularly (make backup)
#    - Encrypt backups with BACKUP_ENCRYPTION_KEY
#
# 5. Secrets Management:
#    - Run: scripts/manage-secrets.sh init
#    - Encrypt .env file for storage
#    - Use secrets/manage-secrets.sh for rotation
#    - Never log or expose secret values
#
# 6. Compliance:
#    - Audit logs are written to Docker logs as JSON
#    - Query logs: docker logs snapauth-snapauth-1 | grep audit
#    - Enable centralized logging for compliance
#    - Retain logs per your compliance requirements
